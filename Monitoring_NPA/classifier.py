import re
from typing import List, Dict, Set


class ProjectClassifier:
    """–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ –ù–ü–ê –ø–æ —Ç–µ–º–∞—Ç–∏–∫–∞–º –≠–î–û/–ú–ß–î/–≠–ü/–≠–ü–î/–û–§–î"""

    # ============= –°–õ–û–í–ê–†–ò –ö–õ–Æ–ß–ï–í–´–• –°–õ–û–í =============

    KEYWORDS = {
        'mchd': [
            '–º–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º–∞—è –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å',
            '–º—á–¥',
            '–¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ',
            '—Ñ–æ—Ä–º–∞—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏',
            '—Ñ–æ—Ä–º–∞—Ç –º—á–¥',
            '–¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º–∞—è',
            '—É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏',
            '–ø–æ—Ä—è–¥–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º—á–¥',
            '—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º—á–¥',
            '—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –º—á–¥',
            '–±–ª–æ–∫—á–µ–π–Ω —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º—á–¥'
        ],

        'edo': [
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç',
            '–æ–ø–µ—Ä–∞—Ç–æ—Ä —ç–¥–æ',
            '–≥–∏—Å —ç–¥–æ',
            '–≥–∏—Å –≥–æ—Å—ç–¥–æ',
            '—é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç',
            '–∫–∞–¥—Ä–æ–≤—ã–π —ç–¥–æ',
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∫–∞–¥—Ä–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç',
            '–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º',
            '–µ–¥–∏–Ω–æ–µ –æ–∫–Ω–æ',
            '–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è'
        ],

        'ep': [
            '—É—Å–∏–ª–µ–Ω–Ω–∞—è –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å',
            '—É–∫—ç–ø',
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å',
            '—É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–π —Ü–µ–Ω—Ç—Ä',
            '–∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏—Ö —Ü–µ–Ω—Ç—Ä–æ–≤',
            '—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–ª—é—á–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏',
            '–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç',
            '–µ—Å–∏–∞',
            '–∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å',
            '–∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è',
            '–∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π'
        ],

        'epd': [
            '–≥–∏—Å —ç–ø–¥',
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è',
            '—ç—Ç—Ä–Ω',
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–µ –ø–æ—Ä—É—á–µ–Ω–∏–µ —ç–∫—Å–ø–µ–¥–∏—Ç–æ—Ä—É',
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è —ç–∫—Å–ø–µ–¥–∏—Ç–æ—Ä—Å–∫–∞—è —Ä–∞—Å–ø–∏—Å–∫–∞',
            '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –ø—É—Ç–µ–≤–æ–π –ª–∏—Å—Ç',
            '—ç–ø–ª',
            '–ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã',
            '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è',
            '—Ñ–æ—Ä–º–∞—Ç —ç—Ç—Ä–Ω',
            '–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤'
        ],

        'ofd': [
            '–æ–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏—Å–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
            '–æ—Ñ–¥',
            '–∫–∫—Ç',
            '–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ-–∫–∞—Å—Å–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞',
            '–æ–Ω–ª–∞–π–Ω-–∫–∞—Å—Å–∞',
            '—Ñ–∏—Å–∫–∞–ª—å–Ω—ã–π –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å',
            '—Ä–µ–µ—Å—Ç—Ä –æ—Ñ–¥',
            '—Ñ–∏—Å–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ',
            '–∫–∞—Å—Å–æ–≤—ã–π —á–µ–∫'
        ]
    }

    # –í–µ–¥–æ–º—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –Ω–∞—à–∏
    TRUSTED_DEPARTMENTS = {
        '–§–ù–° –†–æ—Å—Å–∏–∏',
        '–ú–∏–Ω—Ü–∏—Ñ—Ä—ã –†–æ—Å—Å–∏–∏',
        '–ú–∏–Ω—Ç—Ä–∞–Ω—Å –†–æ—Å—Å–∏–∏',
        '–ú–∏–Ω—Ç—Ä—É–¥ –†–æ—Å—Å–∏–∏',
        '–§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–µ –∫–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ',
        '–†–æ—Å–∞—Ä—Ö–∏–≤',
        '–ú–∏–Ω—Ñ–∏–Ω –†–æ—Å—Å–∏–∏',
        '–†–æ—Å—Å—Ç–∞—Ç'
    }

    @classmethod
    def classify(cls, title: str, department: str = '') -> Set[str]:
        """
        –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–º–∞—Ç–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ –≤–µ–¥–æ–º—Å—Ç–≤—É.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–±–æ—Ä —Ç–µ–º: {'mchd', 'epd', ...}
        """
        if not title:
            return set()

        title_lower = title.lower()
        found_topics = set()

        # 1. –ò—â–µ–º –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
        for topic, keywords in cls.KEYWORDS.items():
            for keyword in keywords:
                if keyword.lower() in title_lower:
                    found_topics.add(topic)
                    break  # –Ω–∞—à–ª–∏ —Ç–µ–º—É, –¥–∞–ª—å—à–µ –ø–æ —Å–ª–æ–≤–∞–º –Ω–µ –∏–¥—ë–º

        # 2. –ï—Å–ª–∏ –≤–µ–¥–æ–º—Å—Ç–≤–æ –∏–∑ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö, –¥–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É (–Ω–æ –Ω–µ –¥–ª—è –≤—Å–µ—Ö)
        if department in cls.TRUSTED_DEPARTMENTS:
            # –ú–∏–Ω—Ç—Ä–∞–Ω—Å –±–µ–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ ‚Äî —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≠–ü–î
            if department == '–ú–∏–Ω—Ç—Ä–∞–Ω—Å –†–æ—Å—Å–∏–∏' and not found_topics:
                found_topics.add('epd')
            # –§–ù–° –±–µ–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –≠–î–û –∏–ª–∏ –ú–ß–î
            elif department == '–§–ù–° –†–æ—Å—Å–∏–∏' and not found_topics:
                found_topics.add('edo')

        return found_topics

    @classmethod
    def get_topic_name(cls, topic_code: str) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã"""
        names = {
            'mchd': 'üìÑ –ú–ß–î',
            'edo': 'üìÅ –≠–î–û',
            'ep': '‚úçÔ∏è –≠–ü',
            'epd': 'üöõ –≠–ü–î',
            'ofd': 'üßæ –û–§–î'
        }
        return names.get(topic_code, topic_code)

    @classmethod
    def format_topics(cls, topics: Set[str]) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –Ω–∞–±–æ—Ä —Ç–µ–º –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –≤—ã–≤–æ–¥–∞"""
        if not topics:
            return '‚ùì –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'
        return ' '.join([cls.get_topic_name(t) for t in topics])


# ============= –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï =============
if __name__ == "__main__":
    print("=" * 70)
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ö–õ–ê–°–°–ò–§–ò–ö–ê–¢–û–†–ê")
    print("=" * 70)

    test_cases = [
        ("–û –≤–Ω–µ—Å–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç –º–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º–æ–π –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏", "–§–ù–° –†–æ—Å—Å–∏–∏"),
        ("–û–± —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–æ—Ä—è–¥–∫–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞", "–ú–∏–Ω—Ü–∏—Ñ—Ä—ã –†–æ—Å—Å–∏–∏"),
        ("–û –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –£–ö–≠–ü –≤ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö", "–ú–∏–Ω—Ü–∏—Ñ—Ä—ã –†–æ—Å—Å–∏–∏"),
        ("–û –≤–Ω–µ—Å–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–≤–æ–∑–æ–∫ –≥—Ä—É–∑–æ–≤ (–ì–ò–° –≠–ü–î)", "–ú–∏–Ω—Ç—Ä–∞–Ω—Å –†–æ—Å—Å–∏–∏"),
        ("–û–± —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–π –Ω–∞–∫–ª–∞–¥–Ω–æ–π", "–ú–∏–Ω—Ç—Ä–∞–Ω—Å –†–æ—Å—Å–∏–∏"),
        ("–û –ø–æ—Ä—è–¥–∫–µ –≤–µ–¥–µ–Ω–∏—è —Ä–µ–µ—Å—Ç—Ä–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Ñ–∏—Å–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö", "–§–ù–° –†–æ—Å—Å–∏–∏"),
        ("–û–± —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ —Ç–∏–ø–æ–≤–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –ú–∏–Ω–∑–¥—Ä–∞–≤–∞", "–ú–∏–Ω–∑–¥—Ä–∞–≤ –†–æ—Å—Å–∏–∏"),  # –Ω–µ –Ω–∞—à–∞ —Ç–µ–º–∞
    ]

    for title, dept in test_cases:
        topics = ProjectClassifier.classify(title, dept)
        topic_str = ProjectClassifier.format_topics(topics)
        print(f"\nüìå {title[:70]}...")
        print(f"   üè¢ {dept}")
        print(f"   üéØ {topic_str}")